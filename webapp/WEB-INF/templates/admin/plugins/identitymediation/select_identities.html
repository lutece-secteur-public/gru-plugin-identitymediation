<style>
    #select-identities-table th, #select-identities-table .rounded-pill {
        text-transform: uppercase;
    }
</style>
<script type="text/javascript">
    $(function () {
        $('#continue-btn').hide();
        $('.selected-identity-btn').hide();

        $('button.select-identity-btn').click(function () {
            $(this).hide();
            $(this).parent().children('.selected-identity-btn').show();
            $("input[value='" + $(this).data('cuid') + "']").prop('disabled', false);
            if ($('.selected-identity-btn:visible').length === 2) {
                $('#continue-btn').show();
                $('button.select-identity-btn').prop('disabled', true);
            }
        });
        $('button.selected-identity-btn').click(function () {
            $(this).hide();
            $(this).parent().children('.select-identity-btn').show();
            $("input[value='" + $(this).data('cuid') + "']").prop('disabled', true);
            $('#continue-btn').hide();
            $('button.select-identity-btn').prop('disabled', false);
        });
    });
</script>

<form class="form-inline" action="jsp/admin/plugins/identitymediation/IdentityDuplicate.jsp">
    <@rowBox>
        <@boxHeader i18nTitleKey="identitymediation.resolve_duplicates.title">
            <@headerButtons>
            </@headerButtons>
        </@boxHeader>
        <@boxBody>
            <@messages infos=infos />
            <@messages errors=errors />
            <@messages warnings=warnings />

            <#if service_contract??>
                <@table id="select-identities-table">
                    <tr>
                        <th>&nbsp;</th>
                        <#assign count = 1>
                        <#list identity_list as identity>
                            <th class="fw-normal">
                                <div class="col-12">#i18n{identitymediation.select_identities.identity} ${count}</div>
                                <div class="col-12"><span class="quality-span">${identity.quality.quality}</span> %</div>
                                <#if identity.monParisActive >
                                    <span class="badge mon-paris-badge">MON PARIS</span>
                                </#if>
                                <input type="hidden" name="identity-cuid-${count}" value="${identity.customerId}" disabled >
                            </th>
                            <#assign count = count + 1>
                        </#list>
                    </tr>
                    <@tableHeadBodySeparator />
                    <#list service_contract.attributeDefinitions?filter(a -> a.attributeRight.readable) as readableAttr>
                        <tr>
                            <td>${readableAttr.name}</td>
                            <#list identity_list as identity>
                                <td>
                                    <#list identity.attributes?filter(a -> a.key == readableAttr.keyName) as attr>
                                        <span class="${attr.key}-value">${attr.value}</span>
                                        <#if attr.certifier??>
                                            <span class="badge rounded-pill bg-info mx-1">${attr.certifier}</span>
                                        </#if>
                                        <#if attr.certificationDate??>
                                            <span class="certification-date">${attr.certificationDate?date}</span>
                                        </#if>
                                    </#list>
                                </td>
                            </#list>
                        </tr>
                    </#list>
                    <tr>
                        <td>&nbsp;</td>
                        <#list identity_list as identity>
                            <td>
                                <button type="button" class="btn btn-outline-warning select-identity-btn" data-cuid="${identity.customerId}">
                                    #i18n{identitymediation.select_identities.buttonSelectIdentity}
                                </button>
                                <button type="button" class="btn btn-warning selected-identity-btn" data-cuid="${identity.customerId}" >
                                    #i18n{identitymediation.select_identities.buttonSelectedIdentity}
                                </button>
                            </td>
                        </#list>
                    </tr>
                </@table>
            </#if>
        </@boxBody>
    </@rowBox>
    <@rowBox boxClass="action-box">
        <@boxBody>
            <button id="continue-btn" class="btn btn-warning" name="view_resolveDuplicates" >
                #i18n{identitymediation.select_identities.buttonContinue}
            </button>
            <button class="btn btn-secondary" name="view_chooseDuplicateType" >
                #i18n{identitymediation.resolve_duplicates.buttonCancel}
            </button>
        </@boxBody>
    </@rowBox>
</form>